<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migrations - NUSANTARA HMVC</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>NUSANTARA HMVC</h2>
                <p>Version 1.0 - Beta</p>
                <small>A Lightweight PHP HMVC Framework</small>
            </div>
            <ul class="sidebar-nav">
                <li><a href="../index.html">Overview</a></li>
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="structure.html">Project Structure</a></li>
                <li><a href="mvc.html">MVC Architecture</a></li>
                <li><a href="routing.html">Routing</a></li>
                <li><a href="migrations.html" class="active">Migrations</a></li>
                <li><a href="autoload.html">Autoload</a></li>
                <li><a href="database.html">Database</a></li>
                <li><a href="forms.html">Forms & Validation</a></li>
                <li><a href="security.html">Security</a></li>
                <li><a href="helpers.html">Helpers</a></li>
            </ul>
        </nav>
        <main class="content">
            <section id="migrations">
                <h1>Database Migrations</h1>
                <p>NUSANTARA HMVC provides a simple migration system to help you manage database schema changes.</p>

                <h2>Migration Files</h2>
                <p>Migration files are stored in <code>databases/migrations/</code> directory with SQL format:</p>
                <pre><code class="language-plaintext">databases/migrations/
├── 001_create_tbl_m_items.sql
├── 002_create_some_other_table.sql
└── ...</code></pre>

                <h2>Running Migrations</h2>
                <p>You can run migrations using the CLI command:</p>
                <pre><code class="language-bash">cd /path/to/medkit3
php migrate.php</code></pre>

                <h2>Migration Class</h2>
                <p>The migration system is handled by <code>migrate.php</code> in the root directory:</p>
                <pre><code class="language-php">class Migrate {
    private $conn;
    private $migrations = [];
    
    public function __construct() {
        try {
            $this->conn = Database::getInstance()->getConnection();
            $this->createMigrationsTable();
            $this->loadMigrations();
        } catch (Exception $e) {
            die("Migration Error: " . $e->getMessage() . "\n");
        }
    }
    
    // ... other methods
}</code></pre>

                <h2>Creating Migrations</h2>
                <p>Create a new SQL file in the migrations directory following this pattern:</p>
                <pre><code class="language-sql">CREATE TABLE `table_name` (
    `id` INT(11) NOT NULL AUTO_INCREMENT,
    `field_name` VARCHAR(255) NULL DEFAULT NULL,
    `created_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1 COLLATE='utf8mb3_general_ci';</code></pre>

                <h2>Migration Tracking</h2>
                <p>The system tracks executed migrations in the <code>migrations</code> table:</p>
                <pre><code class="language-sql">CREATE TABLE migrations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    migration VARCHAR(255),
    executed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code></pre>

                <h2>Features</h2>
                <ul>
                    <li>Automatic migration tracking</li>
                    <li>Only runs new migrations</li>
                    <li>SQL-based migrations</li>
                    <li>Command-line interface</li>
                    <li>Error handling and logging</li>
                </ul>
            </section>
        </main>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="../js/script.js"></script>
</body>
</html> 